---
import { Stack } from "@styled-system/jsx";
import BlogCard from "./blog-card.astro";
import fetchApi, { getImagesApi } from "../../lib/strapi";
import type Article from "../../../src/interfaces/article";

interface Props {
  limit?: number;
}

const { limit } = Astro.props;

const articles = await fetchApi<Article[]>({
  endpoint: "articles",
  wrappedByKey: "data",
  query: {
    populate: "all",
  },
});

// Helper pour formater la date
function formatDate(dateString: string): string {
  const date = new Date(dateString);
  return date.toLocaleDateString("en-US", {
    month: "short",
    day: "numeric",
    year: "numeric",
  });
}

// Helper pour générer les tags d'un article
function getArticleTags(article: Article) {
  const tags = [];

  // Ajouter la catégorie si elle existe
  if (article.category && article.category.length > 0) {
    tags.push({
      icon: article.category[0] === "guide" ? "guide" : "paw",
      label: article.category[0],
    });
  }

  // Ajouter le temps de lecture
  if (article.read_time) {
    tags.push({
      icon: "clock",
      label: `${article.read_time} Min de lecture`,
    });
  }

  return tags;
}

const displayedArticles = limit ? articles.slice(0, limit) : articles;
---

<Stack className="grid" id="articles-grid">
  {
    displayedArticles.map((article) => (
      <BlogCard
        name={article.title}
        image={article.cover ? getImagesApi(article.cover) : ""}
        tags={getArticleTags(article)}
        date={formatDate(article.date)}
        href={`/articles/${article.slug}`}
      />
    ))
  }
</Stack>

<style>
  .grid {
    display: grid;
    gap: 50px;
    grid-template-columns: repeat(2, minmax(1px, 1fr));
    height: min-content;
    justify-content: center;
    width: 100%;
  }

  /* Tablette - 1 colonne pour écrans moyens */
  @media (max-width: 1024px) {
    .grid {
      gap: 40px;
      grid-template-columns: repeat(2, minmax(1px, 1fr));
    }
  }

  /* Tablette portrait - 1 colonne */
  @media (max-width: 768px) {
    .grid {
      gap: 32px;
      grid-template-columns: 1fr;
    }
  }

  /* Mobile - 1 colonne avec gap réduit */
  @media (max-width: 480px) {
    .grid {
      gap: 24px;
      grid-template-columns: 1fr;
    }
  }
</style>
